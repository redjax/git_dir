# yaml-language-server: $schema=https://taskfile.dev/schema.json
---
version: "3"

vars:
  SCAN_TARGET: "."

tasks:
  scan-osv:
    desc: Run OSV Scanner on a single directory
    cmds:
      - cmd: |
          echo "Running OSV Scanner on $SCAN_TARGET"
          if find "$SCAN_TARGET" -maxdepth 2 \( -name 'go.mod' -o -name 'package.json' -o -name 'pom.xml' -o -name 'Cargo.toml' -o -name 'requirements.txt' -o -name 'pyproject.toml' \) -print -quit | grep -q .; then
            osv-scanner scan "$SCAN_TARGET" || true
          else
            echo "â†’ No dependency manifests found, skipping"
          fi


  scan-gitleaks:
    desc: Run Gitleaks on a single directory
    cmds:
      - cmd: |
          echo "Running Gitleaks on $SCAN_TARGET"
          gitleaks detect --source "$SCAN_TARGET" --report-format=json || true

  scan-trufflehog:
    desc: Run TruffleHog on a single directory
    cmds:
      - cmd: |
          echo "Running TruffleHog on $SCAN_TARGET"
          cd "$SCAN_TARGET" && trufflehog filesystem . || true

  scan-all:
    desc: Run all scanners on a single directory
    cmds:
      - cmd: |
          echo "Scanning $SCAN_TARGET with all scanners..."
          osv-scanner scan --dir "$SCAN_TARGET"
          gitleaks detect --source "$SCAN_TARGET" --report-format=json || true
          trufflehog git --directory "$SCAN_TARGET" || true
