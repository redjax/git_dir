# yaml-language-server: $schema=https://taskfile.dev/schema.json
---
version: "3"

tasks:
  status-all:
    desc: Show status of all projects
    cmds:
      - platforms: [linux, darwin]
        cmd: |-
          set -e
          for d in ./*/.git; do
            if [ -d "$d" ]; then
              echo "=== $(basename "$(dirname "$d")") ==="
              (cd "$(dirname "$d")" && git status -s) || true
            fi
          done

  fetch-all:
    desc: Do a 'fetch --all --prune' on all repositories
    cmds:
      - platforms: [linux, darwin]
        cmd: |
          find . -type d -name .git -prune | while read -r gitdir; do
            repo="$(dirname "$gitdir")"
            echo "=== $(basename "$repo") ==="
            git -C "$repo" fetch --all --prune || echo "(fetch failed)"
          done
